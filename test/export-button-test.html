<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Export Button Test Page</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      color: #1a1a1a;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }

    .alert {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 16px;
      margin-bottom: 30px;
      border-radius: 4px;
    }

    .alert h3 {
      color: #1976d2;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .alert p {
      color: #424242;
      font-size: 14px;
      line-height: 1.6;
    }

    .test-section {
      background: #f8f9fa;
      padding: 24px;
      border-radius: 8px;
      margin-bottom: 24px;
      border: 2px solid #e0e0e0;
    }

    .test-section h2 {
      font-size: 20px;
      margin-bottom: 16px;
      color: #1a1a1a;
    }

    .step {
      display: flex;
      align-items: flex-start;
      margin-bottom: 16px;
      padding: 12px;
      background: white;
      border-radius: 6px;
      border-left: 3px solid #6B5B4B;
    }

    .step-number {
      background: #6B5B4B;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
    }

    .step-title {
      font-weight: 600;
      margin-bottom: 4px;
      color: #1a1a1a;
    }

    .step-desc {
      font-size: 14px;
      color: #666;
      line-height: 1.5;
    }

    .code {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 13px;
    }

    .checklist {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .checklist h3 {
      font-size: 16px;
      margin-bottom: 12px;
      color: #1a1a1a;
    }

    .check-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .check-item input[type="checkbox"] {
      margin-right: 10px;
      margin-top: 3px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .check-item label {
      cursor: pointer;
      color: #424242;
    }

    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 12px 16px;
      margin: 16px 0;
      border-radius: 4px;
    }

    .warning-title {
      font-weight: 600;
      color: #856404;
      margin-bottom: 4px;
    }

    .warning-text {
      color: #856404;
      font-size: 14px;
    }

    .success {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 12px 16px;
      margin: 16px 0;
      border-radius: 4px;
    }

    .success-text {
      color: #155724;
      font-size: 14px;
    }

    .cookie-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin: 16px 0;
    }

    .info-card {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }

    .info-label {
      font-size: 11px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 18px;
      font-weight: bold;
      color: #1a1a1a;
    }

    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: #6B5B4B;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
      margin-right: 10px;
    }

    .btn:hover {
      background: #5a4a3c;
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #666;
      border: 1px solid #e0e0e0;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    #cookie-stats {
      display: none;
    }

    .expected-output {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 16px;
      border-radius: 6px;
      margin: 16px 0;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      overflow-x: auto;
      white-space: pre;
    }

    .json-key {
      color: #f92672;
    }

    .json-string {
      color: #a6e22e;
    }

    .json-number {
      color: #ae81ff;
    }

    .json-bool {
      color: #66d9ef;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üç™ Export Button Testing</h1>
    <p class="subtitle">Test the cookie export functionality of your CookieGuard Chrome extension</p>

    <div class="alert">
      <h3>üìç You're on the Test Page</h3>
      <p>This page has been set up with test cookies for you. Use your extension's export button and follow the steps below.</p>
    </div>

    <!-- Current Page Cookies -->
    <div class="test-section">
      <h2>üìä Test Cookies on This Page</h2>
      <div id="cookie-stats">
        <div class="cookie-info">
          <div class="info-card">
            <div class="info-label">Total Cookies</div>
            <div class="info-value" id="total-cookies">0</div>
          </div>
          <div class="info-card">
            <div class="info-label">Domain</div>
            <div class="info-value" id="page-domain" style="font-size: 14px;">-</div>
          </div>
        </div>
        <div id="cookie-list" style="margin-top: 12px;"></div>
      </div>
      <button class="btn" onclick="setupTestCookies()">Setup Test Cookies</button>
      <button class="btn btn-secondary" onclick="viewCurrentCookies()">View Current Cookies</button>
      <button class="btn btn-secondary" onclick="clearTestCookies()">Clear Test Cookies</button>
    </div>

    <!-- Test Instructions -->
    <div class="test-section">
      <h2>üß™ How to Test the Export Button</h2>
      
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <div class="step-title">Setup Test Cookies</div>
          <div class="step-desc">
            Click "Setup Test Cookies" above to create test cookies on this page. 
            You should see cookies appear in the list.
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <div class="step-title">Open Your Extension</div>
          <div class="step-desc">
            Click the CookieGuard extension icon in your Chrome toolbar. 
            The popup should open and detect this page's domain.
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <div class="step-title">Click the Export Button</div>
          <div class="step-desc">
            In the extension popup, click the <span class="code">Export</span> button.
            This should trigger the <span class="code">exportCookiesAsJson()</span> function.
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <div class="step-title">Save the JSON File</div>
          <div class="step-desc">
            A file download should begin. Save the file (e.g., <span class="code">cookies-export-*.json</span>).
            If no download happens, check the browser console (F12) for errors.
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">5</div>
        <div class="step-content">
          <div class="step-title">Verify the Export</div>
          <div class="step-desc">
            Open the downloaded JSON file in a text editor or upload it to the 
            <span class="code">cookie-tester.html</span> tool to validate the format.
          </div>
        </div>
      </div>
    </div>

    <!-- Expected Output -->
    <div class="test-section">
      <h2>‚úÖ What to Expect</h2>
      
      <h3 style="font-size: 16px; margin-bottom: 12px;">Expected JSON Structure:</h3>
      <div class="expected-output">{
  <span class="json-key">"exported_at"</span>: <span class="json-string">"2025-02-08T15:30:00.000Z"</span>,
  <span class="json-key">"domain"</span>: <span class="json-string">"your-test-page-domain"</span>,
  <span class="json-key">"total_cookies"</span>: <span class="json-number">8</span>,
  <span class="json-key">"cookies"</span>: [
    {
      <span class="json-key">"name"</span>: <span class="json-string">"test_session"</span>,
      <span class="json-key">"value"</span>: <span class="json-string">"..."</span>,
      <span class="json-key">"domain"</span>: <span class="json-string">"..."</span>,
      <span class="json-key">"path"</span>: <span class="json-string">"/"</span>,
      <span class="json-key">"secure"</span>: <span class="json-bool">true</span>,
      <span class="json-key">"httpOnly"</span>: <span class="json-bool">true</span>,
      <span class="json-key">"sameSite"</span>: <span class="json-string">"lax"</span>,
      <span class="json-key">"type"</span>: <span class="json-string">"authentication"</span>
    }
    <span class="json-key">// ... more cookies</span>
  ]
}</div>

      <div class="checklist">
        <h3>Validation Checklist:</h3>
        <div class="check-item">
          <input type="checkbox" id="check1">
          <label for="check1">File downloads automatically when Export button is clicked</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check2">
          <label for="check2">File name follows pattern: <code>cookies-export-[timestamp].json</code></label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check3">
          <label for="check3">JSON is valid and can be parsed</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check4">
          <label for="check4">Contains required fields: exported_at, domain, total_cookies, cookies</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check5">
          <label for="check5">Cookies array contains all test cookies from this page</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check6">
          <label for="check6">Each cookie has: name, value, domain, secure, httpOnly, sameSite</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check7">
          <label for="check7">Cookie type field is present and classified correctly</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check8">
          <label for="check8">Domain matches current page domain</label>
        </div>
        <div class="check-item">
          <input type="checkbox" id="check9">
          <label for="check9">Total count matches actual number of cookies</label>
        </div>
      </div>
    </div>

    <!-- Troubleshooting -->
    <div class="test-section">
      <h2>üîß Troubleshooting</h2>
      
      <div class="warning">
        <div class="warning-title">‚ùå Export Button Does Nothing</div>
        <div class="warning-text">
          ‚Ä¢ Open DevTools Console (F12) and check for JavaScript errors<br>
          ‚Ä¢ Verify the button has the correct event listener attached<br>
          ‚Ä¢ Check that <code>exportCookiesAsJson()</code> function exists<br>
          ‚Ä¢ Ensure extension has cookie permissions
        </div>
      </div>

      <div class="warning">
        <div class="warning-title">‚ùå No Cookies in Export</div>
        <div class="warning-text">
          ‚Ä¢ Make sure you clicked "Setup Test Cookies" first<br>
          ‚Ä¢ Verify cookies exist in DevTools ‚Üí Application ‚Üí Cookies<br>
          ‚Ä¢ Check that <code>chrome.cookies.getAll()</code> has permissions<br>
          ‚Ä¢ Try refreshing the page and setting up cookies again
        </div>
      </div>

      <div class="warning">
        <div class="warning-title">‚ùå Download Fails</div>
        <div class="warning-text">
          ‚Ä¢ Check browser download settings (pop-ups might be blocked)<br>
          ‚Ä¢ Verify the blob creation code in your extension<br>
          ‚Ä¢ Look for CORS or security errors in console<br>
          ‚Ä¢ Try a different browser or incognito mode
        </div>
      </div>

      <div class="warning">
        <div class="warning-title">‚ùå Wrong Domain Exported</div>
        <div class="warning-text">
          ‚Ä¢ Extension might be getting cookies from all domains<br>
          ‚Ä¢ Check the <code>currentDomain</code> variable in popup.js<br>
          ‚Ä¢ Ensure <code>getCookiesForDomain()</code> filters correctly<br>
          ‚Ä¢ Verify <code>chrome.tabs.query()</code> returns correct tab
        </div>
      </div>
    </div>

    <!-- Quick Links -->
    <div class="test-section">
      <h2>üîó Next Steps</h2>
      <p style="margin-bottom: 16px; color: #666;">After exporting, validate your JSON file:</p>
      <a href="cookie-tester.html" class="btn">Open Cookie Tester Tool</a>
      <button class="btn btn-secondary" onclick="showConsoleCommands()">Show Console Commands</button>
    </div>
  </div>

  <script>
    // Setup test cookies
    function setupTestCookies() {
      const testCookies = [
        { name: 'test_session', value: 'sess_abc123', type: 'authentication' },
        { name: 'test_auth_token', value: 'token_xyz789', type: 'authentication' },
        { name: 'test_user_id', value: '12345', type: 'authentication' },
        { name: 'test_tracking', value: 'track_def456', type: 'tracking' },
        { name: 'test_analytics', value: 'GA1.2.123456', type: 'tracking' },
        { name: 'test_preferences', value: 'theme=dark', type: 'functional' },
        { name: 'test_language', value: 'en-US', type: 'functional' },
        { name: 'test_cart', value: 'cart_id_999', type: 'functional' }
      ];

      let created = 0;
      testCookies.forEach(cookie => {
        try {
          document.cookie = `${cookie.name}=${cookie.value}; path=/; max-age=3600; SameSite=Lax`;
          created++;
        } catch (e) {
          console.error('Failed to create cookie:', cookie.name, e);
        }
      });

      setTimeout(() => {
        viewCurrentCookies();
        alert(`‚úì Created ${created} test cookies. Now open your extension and click Export!`);
      }, 100);
    }

    function viewCurrentCookies() {
      const cookies = document.cookie.split(';').filter(c => c.trim());
      const domain = window.location.hostname || 'localhost';
      
      document.getElementById('page-domain').textContent = domain;
      document.getElementById('total-cookies').textContent = cookies.length;
      
      const listDiv = document.getElementById('cookie-list');
      if (cookies.length === 0) {
        listDiv.innerHTML = '<div style="color: #666; font-size: 14px; padding: 8px;">No cookies found. Click "Setup Test Cookies" first.</div>';
      } else {
        listDiv.innerHTML = cookies.map(cookie => {
          const [name, value] = cookie.split('=').map(s => s.trim());
          return `
            <div style="background: white; padding: 8px 12px; margin-bottom: 4px; border-radius: 4px; border: 1px solid #e0e0e0; font-size: 13px;">
              <strong>${name}</strong>: ${value?.substring(0, 30)}${value?.length > 30 ? '...' : ''}
            </div>
          `;
        }).join('');
      }
      
      document.getElementById('cookie-stats').style.display = 'block';
    }

    function clearTestCookies() {
      const cookies = document.cookie.split(';');
      let cleared = 0;
      
      cookies.forEach(cookie => {
        const name = cookie.split('=')[0].trim();
        if (name.startsWith('test_')) {
          document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
          cleared++;
        }
      });
      
      setTimeout(() => {
        viewCurrentCookies();
        alert(`‚úì Cleared ${cleared} test cookies`);
      }, 100);
    }

    function showConsoleCommands() {
      const commands = `
// Useful console commands for debugging:

// 1. View all cookies from Chrome API (run in extension background/popup context)
chrome.cookies.getAll({}, (cookies) => {
  console.log('All cookies:', cookies);
});

// 2. View cookies for current domain
chrome.tabs.query({active: true, currentWindow: true}, (tabs) => {
  const url = new URL(tabs[0].url);
  chrome.cookies.getAll({domain: url.hostname}, (cookies) => {
    console.log('Domain cookies:', cookies);
  });
});

// 3. Test export function directly
exportCookiesAsJson();

// 4. Check if cookies are accessible
console.log('Document cookies:', document.cookie);

// 5. View extension permissions
chrome.permissions.getAll((permissions) => {
  console.log('Permissions:', permissions);
});
      `.trim();

      const textarea = document.createElement('textarea');
      textarea.value = commands;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      
      alert('‚úì Console commands copied to clipboard! Paste in browser DevTools.');
    }

    // Auto-detect if cookies already exist
    window.addEventListener('load', () => {
      const cookies = document.cookie.split(';').filter(c => c.trim());
      if (cookies.some(c => c.includes('test_'))) {
        viewCurrentCookies();
      }
    });
  </script>
</body>
</html>
